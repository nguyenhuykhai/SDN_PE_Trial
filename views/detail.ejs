<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Login Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <!-- Include file header.ejs -->
    <%- include('header') -%>
    <section style="background-color: #eee;">
        <div class="container py-5">
            <!-- Hiển thị message gửi từ phía Server -->
            <% if(typeof message !== 'undefined' && message !== undefined) { %>
                <h1><%= message %></h1>
            <% } %>
            <% if(typeof error !== 'undefined' && error !== undefined) { %>
                <h1><%= error %></h1>
            <% } %>

            <div id="toast"></div>

            <% if(typeof data !=='undefined' && data.length> 0) { %>
              <div class="card text-black">
                <div class="card-body">
                        <p class="h1 text-uppercase">Chi tiết khóa học</p>
                        <form action="/course/<%= data[0]._id %>/edit" method="POST">
                            <input type="hidden" name="courseId" value="<%= data[0]._id %>" />
                            <div class="mb-3">
                                <label for="exampleFormControlInput1" class="h6 form-label fw-bold" style="float: inline-start">Tiêu đề khóa học</label>
                                <input type="text" name="title" value="<%= data[0].courseName %>" class="form-control" id="exampleFormControlInput1">
                              </div>
                              <div class="mb-3">
                                <label for="exampleFormControlInput1" class="h6 form-label fw-bold" style="float: inline-start">Mô tả</label>
                                <input type="text" name="titleDescription" value="<%= data[0].courseDescription %>" class="form-control" id="exampleFormControlInput2">
                              </div>
                              <button type="submit" class="btn btn-outline-success">Chỉnh sửa khóa học</button>
                              <a href="/course/<%= data[0]._id %>/delete" class="btn btn-outline-danger">Xóa khóa học</a>
                        </form>
                        <p class="h5 text-uppercase fw-bold mt-4">Danh sách section</p>
                        <% if(typeof data[0].sections !=='undefined' && data[0].sections.length> 0) { %>
                          <% data[0].sections.forEach(function(item) { %>
                              <div class="accordion accordion-flush mt-1" id="accordionFlushExample<%= item._id %>">
                                <div class="accordion-item">
                                  <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                      data-bs-target="#flush-collapseOne<%= item._id %>" aria-expanded="false"
                                      aria-controls="flush-collapseOne<%= item._id %>">
                                      <strong>
                                        <%= item.sectionName %>
                                      </strong>
                                    </button>
                                  </h2>
                                  <div id="flush-collapseOne<%= item._id %>" class="accordion-collapse collapse"
                                    data-bs-parent="#accordionFlushExample<%= item._id %>">
                                    <div class="accordion-body">
                                      <form action="/section/<%= item._id %>/edit" method="POST">
                                        <input type="hidden" name="sectionId" value="<%= item._id %>" />
                                        <input type="hidden" name="course" value="<%= item.course %>" />
                                        <div>
                                          <label for="exampleFormControlInput3" class="h6 form-label fw-bold" style="float: inline-start">Tiêu đề
                                            section</label>
                                          <input type="text" name="sectionName" value="<%= item.sectionName %>" class="form-control pb-3"
                                            id="exampleFormControlInput3" style="text-align: justify; text-justify: inter-word;">
                                        </div>
                                        <div>
                                          <label for="exampleFormControlInput4" class="h6 form-label fw-bold" style="float: inline-start">Mô
                                            tả</label>
                                          <textarea class="form-control" name="sectionDescription" id="exampleFormControlInput4" rows="3"
                                            id="floatingTextarea"
                                            style="text-align: justify; text-justify: inter-word;"><%= item.sectionDescription %></textarea>
                                        </div>
                                        <div>
                                          <label for="exampleFormControlInput5" class="h6 form-label fw-bold" style="float: inline-start">Thời
                                            lượng</label>
                                          <input type="number" name="duration" value="<%= item.duration %>" class="form-control pb-3"
                                            id="exampleFormControlInput5">
                                        </div>
                                        <div class="form-check form-switch">
                                          <input class="form-check-input h6" type="checkbox" role="switch" id="flexSwitchCheckChecked"
                                            value="<%= item.isMainTask %>">
                                          <label class="form-check-label h6" for="flexSwitchCheckChecked">Main task</label>
                                        </div>
                                        <div>
                                          <button type="submit" class="btn btn-outline-success">Chỉnh sửa Section</button>
                                          <a href="/section/<%= item._id %>/delete" class="btn btn-outline-danger">Xóa Section</a>
                                        </div>
                                      </form>
                                    </div>
                                  </div>
                                </div>
                              </div>
                          <% }) %>
                        <% } %>
                      </div>
                    </div>
            <% } else { %>
                <div class="d-flex align-items-center">
                    <strong>Loading...</strong>
                    <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div>
                </div>
            <% } %>
        </div>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    <script>
      // Extracting the status parameter from the URL
      const urlParams = new URLSearchParams(window.location.search);
      const status = urlParams.get('status');
      const toastElement = document.getElementById('toast');

      if (toastElement) {
        toastElement.addEventListener('click', () => {
          window.history.replaceState({}, document.title, 'http://localhost:5000/course/64916b697f8a6ac6119055fc');
        })
      }

      // Now you can use the 'status' variable in your template logic
      if (status !== null) {
          if (status === 'successfull') {
              // If status is 'successfull', create the HTML content for the toast
              const htmlContent = `
                <div class="toast-container position-fixed top-0 end-0 p-3">
                  <div id="liveToast" class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header text-bg-success">
                      <strong class="me-auto text-white">Thông báo</strong>
                      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                      Thực hiện thành công
                    </div>
                  </div>
                </div>
              `;
              // Set the HTML content of the toast element
              toastElement.innerHTML = htmlContent;
          } else {
              // If status is 'successfull', create the HTML content for the toast
              const htmlContent = `
                  <div class="toast align-items-center text-bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true" style=" top: 10% !important; left: 1% !important; position: absolute; z-index: 10;">
                      <div class="d-flex">
                          <div class="toast-body">
                              Thực hiện thất bại
                          </div>
                          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                      </div>
                  </div>
              `;
              // Set the HTML content of the toast element
              toastElement.innerHTML = htmlContent;
          }
        
      }
    </script>
  </body>
</html>